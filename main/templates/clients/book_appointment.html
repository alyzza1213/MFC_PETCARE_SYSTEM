{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üêæ Book Appointment</title>
<link rel="stylesheet" href="{% static 'css/clients/booking.css' %}">
<style>
    .concern-box { margin-top: 8px; display: none; }
    .concern-box textarea { width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #ccc; font-size: 14px; }
</style>
</head>
<body>
<header>
    <h1>üêæ Book Appointment</h1>
    <nav>
        <a href="{% url 'homepage' %}">Home</a>
        <a href="{% url 'pet_profile' %}">My Pets</a>
        <a href="{% url 'vet_availability' %}">Vet Availability</a>
        <a href="{% url 'logout' %}">Logout</a>
    </nav>
</header>

<div class="appointment-section">
<h2>Schedule Your Pet's Appointment</h2>
<form method="POST">
    {% csrf_token %}
    {% if pets %}
        {% for pet in pets %}
        <div class="pet-service-row">
            <div class="pet-info">
                <input type="checkbox" name="selected_pets" value="{{ pet.id }}" id="pet_{{ pet.id }}">
                <label for="pet_{{ pet.id }}">{{ pet.name }} ({{ pet.species }})</label>
            </div>
            <div>
                <label for="service_{{ pet.id }}">Select Service:</label>
                <select name="service_{{ pet.id }}" id="service_{{ pet.id }}" class="service-dropdown" data-pet="{{ pet.id }}">
                    <option value="Consultation">Consultation</option>
                    <option value="Check-up">Check-up</option>
                    <option value="Vaccination">Vaccination</option>
                    <option value="Grooming">Grooming</option>
                </select>
                <div class="concern-box" id="concern_box_{{ pet.id }}">
                    <label>Concern / Reason for Visit:</label>
                    <textarea name="concern_{{ pet.id }}" placeholder="Describe your pet's health concern..."></textarea>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <p>No pets available. <a href="{% url 'add_pet' %}">Add a pet first</a>.</p>
    {% endif %}

<label for="slot">Select Vet Slot:</label>
<select name="slot" id="slot" required>
    {% if available_slots %}
        {% for slot in available_slots %}
            <option value="{{ slot|time:'H:i' }}">{{ slot|time:'h:i A' }}</option>
        {% endfor %}
    {% else %}
        <option disabled>No available slots. Check back later.</option>
    {% endif %}
</select>

<label for="notes">Notes (optional):</label>
<textarea name="notes" id="notes" placeholder="Any special requests..."></textarea>

<button type="submit">Book Appointment</button>
</form>

<script>
document.querySelectorAll(".service-dropdown").forEach(select => {
    select.addEventListener("change", function() {
        let petId = this.getAttribute("data-pet");
        let concernBox = document.getElementById("concern_box_" + petId);
        concernBox.style.display = (this.value === "Check-up" || this.value === "Consultation") ? "block" : "none";
    });
});
</script>
</div>
</body>
</html>
